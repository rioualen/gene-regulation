---
title: "Export appliance"
output:
  html_document:
    css: /packages/rsat/public_html/course.css
    fig_caption: yes
    toc: yes
  pdf_document:
    toc: yes
---

## Requirements

### VM creation

See one of these:

* IFB_cloud_VM_creation.Rmd
* virtualbox_VM_creation.Rmd
  
### Software installation

See:

* install_rsat_ubuntu14.04.Rmd
* install_snakemake_workflows.Rmd


# Export appliance TODO

Once the Virtual Machine is working fine, it can be exported to an
appliance.

In VirtualBox, open "File -> Export Appliance ...", and select the VM.

   Save as: rsat-vm-2015-02_[YYYY-MM-DD].ova
   Files of Type: Open Virtualization Format Archive (.ova)

Storage Settings
	Format: OVF 1.0
	v Write Manifest File


Appliance Settings
	Name		rsat-vb-ub14s ***OR***  rsat-vm-2015-02
	Product		Regulatory Sequences Analysis Tools
	Product-URL	http://rsat.eu/
	Vendor		Jacques van Helden
	Vendor URL	http://jacques.van-helden.perso.luminy.univ-amu.fr/
	Version		2014-10-10
	Description	Regulatory Sequence Analysis Tools (RSAT, http://rsat.eu/), installed on an Ubuntu 14.04 Virtual Machine. 
	License		Free of use for academic users, non-commercial and non-military usage. 



################################################################
## Prepare the VM + accompanying material on a USB key, to ensure
## distribution in the teaching room.
##
## We use ScanDisk 64Gb USB3.0 keys, which have a high transfer rate
## (190Mbps write / 250Mbps read)

SOURCE_DIR=/no_backup/VirtualBox_VMs/appliances
VERSION=2014-09-05a

## Specification of the target location
KEY_NB=02
TARGET_DIR=/Volumes/RSAT-VM_${KEY_NB}/
time rsync -ruptvl ${SOURCE_DIR} ${TARGET_DIR}

################
# OPTIONAL: split the VM into smaller files. This can be useful for two purposes.
#
# 1) To transfer files to a FAT-formatted drive for distribution (FAT
#    cannot hold files >4Gb). Note that the final installation drive
#    will have to support files >4Gb for the server version of the VM.
# 2) To facilitate synchronization between local and remote machines.

SPLIT_SIZE=3999m
mkdir -p ${TARGET_DIR}/appliances
time split -b ${SPLIT_SIZE} ${SOURCE_DIR}/rsat-vm-2015-02_${VERSION}.ova ${TARGET_DIR}/appliances/rsat-vm-2015-02_${VERSION}.ova.split${SPLIT_SIZE}_
################

