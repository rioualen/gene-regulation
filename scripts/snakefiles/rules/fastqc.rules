# Check if each required parameter has been defined in the JSON
# configuration file, otherwise use default values

if not "fastqc" in config.keys():
    config["fastqc"] = {}

if not "other_options" in config["fastqc"].keys():
    config["fastqc"]["other_options"] = ""


rule fastqc:
    """Check the quality of a file named {dataset}.fastq, containing
    fastq-formatted raw reads using the program fastQC (quality
    control).  You can add any wanted parameters in the "other
    options" of the config file.  The results are put into a folder
    named '{dataset}_fastqc'.

	Required parameters:
		config['fastqc']['other_options']
		config['qsub']	

	Usage:
		QC = expand(config['dir']['results'] + "{data_dir}/{dataset}_fastqc/", dir_data=DIR_DATA, dataset=DATASETS)

    """
    input: "{data_dir}/{dataset}.fastq"
    output: "{data_dir}/{dataset}_fastqc/{dataset}_fastqc.html"
    log: "{data_dir}/{dataset}_fastqc/{dataset}_fastqc.log"
    benchmark: "{data_dir}/{dataset}_fastqc/{dataset}_fastqc_benchmark.json"
    output: outdir="{data_dir}/{dataset}_fastqc/", benchmark="{data_dir}/{dataset}_fastqc/{dataset}_fastqc_benchmark.json"
    log: "{data_dir}/{dataset}_fastqc/{dataset}_fastqc.log"
    benchmark: "{data_dir}/{dataset}_fastqc/{dataset}_fastqc_benchmark.json"
    params: qsub = config["qsub"] + " -e {data_dir}/{dataset}_fastqc/{dataset}_fastqc_qsub.err -o {data_dir}/{dataset}_fastqc/{dataset}_fastqc_qsub.out", \
            options = config["fastqc"]["other_options"], \
            outdir = "{data_dir}/{dataset}_fastqc/"
    shell:"fastqc --outdir {params.outdir} --format fastq {input} {params.options} 2> {log} "
