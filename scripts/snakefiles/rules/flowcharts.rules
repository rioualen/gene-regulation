import os

from snakemake.utils import read_job_properties

rule flowcharts:
    """Draw flowcharts for the current snakefile: dag and rulegraph.

    Requires to specify the following entries in the config
    dictionary.

    config["reports"]["dag"]
    config["reports"]["rulegraph"]

    We have to specify the snakefile that we want to use

    config["reports"]["snakefile"]

    """
    output: dag_pdf = config["reports"]["dag"] + ".pdf", \
            dag_png = config["reports"]["dag"] + ".png", \
            rulegraph_pdf = config["reports"]["rulegraph"] + ".pdf", \
            rulegraph_png = config["reports"]["rulegraph"] + ".png"
    params: scripts = config["reports"]["snakefile"]
    shell: "snakemake -s {params.scripts} --rulegraph | dot -Tpdf -o {output.rulegraph_pdf} " \
           + "; snakemake -s {params.scripts} --rulegraph | dot -Tpng -o {output.rulegraph_png} " \
           + "; snakemake -s {params.scripts} --dag  | perl -pe 's/graph\[/graph\[rankdir='LR', /' | dot -Tpdf -o {output.dag_pdf} " \
           + "; snakemake -s {params.scripts} --dag  | perl -pe 's/graph\[/graph\[rankdir='LR', /' | dot -Tpng -o {output.dag_png} "
    
